const fs = require("fs");
const path = require("path");

const sponsorsDir = path.join(__dirname, "..", "public", "images", "sponsors");
const outFile = path.join(__dirname, "..", "src", "config", "sponsors.generated.ts");
const metadataPath = path.join(__dirname, "sponsors-metadata.json");

const imageExtensions = new Set([".png", ".jpg", ".jpeg", ".gif", ".webp", ".svg"]);

let metadata = {};
if (fs.existsSync(metadataPath)) {
  metadata = JSON.parse(fs.readFileSync(metadataPath, "utf8"));
}

let entries = [];
if (fs.existsSync(sponsorsDir)) {
  entries = fs.readdirSync(sponsorsDir)
    .filter((name) => imageExtensions.has(path.extname(name).toLowerCase()))
    .sort()
    .map((name) => {
      const meta = metadata[name] || {};
      return {
        src: `/images/sponsors/${encodeURIComponent(name)}`,
        alt: meta.alt,
        link: meta.link,
      };
    });
}

const content = `// Auto-generated by scripts/generate-sponsors-list.js - run "npm run build" or "node scripts/generate-sponsors-list.js" to update
export const SPONSOR_IMAGES: { src: string; alt?: string; link?: string }[] = ${JSON.stringify(entries, null, 2)};
`;

fs.writeFileSync(outFile, content, "utf8");
console.log("Generated", outFile, "with", entries.length, "sponsor image(s).");
